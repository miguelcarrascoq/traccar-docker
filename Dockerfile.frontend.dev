FROM node:20-alpine

WORKDIR /app

# Install git for potential updates
RUN apk add --no-cache git

# Install nodemon for hot reloading
RUN npm install -g nodemon

# Create entrypoint script
RUN cat > /entrypoint.sh << 'EOF'
#!/bin/sh
echo "ðŸš€ Iniciando frontend en modo desarrollo..."

# Esperar a que el cÃ³digo fuente estÃ© disponible
while [ ! -f "/app/package.json" ]; do
    echo "â³ Esperando cÃ³digo fuente..."
    sleep 5
done

# Actualizar cÃ³digo fuente antes de instalar dependencias
if [ -d ".git" ]; then
    echo "ðŸ”„ Actualizando cÃ³digo fuente desde remoto..."
    git pull
fi

echo "ðŸ“¦ Instalando dependencias..."
npm install

# Ejecutar lint antes de iniciar el servidor
if npm run lint; then
    echo "âœ… Lint exitoso, iniciando servidor..."
else
    echo "âŒ Error en lint. Deteniendo el proceso."
    exit 1
fi

echo "ðŸŒŸ Iniciando servidor de desarrollo..."
npm start
EOF

RUN chmod +x /entrypoint.sh

# Expose port
EXPOSE 3000

# Start development server
CMD ["/entrypoint.sh"]
