FROM eclipse-temurin:17-jdk-alpine

WORKDIR /app

# Install git and maven
RUN apk add --no-cache git maven

# Create entrypoint script
RUN cat > /entrypoint.sh << 'EOF'
#!/bin/sh
echo "ðŸš€ Iniciando backend en modo desarrollo..."

# Esperar a que el cÃ³digo fuente estÃ© disponible
while [ ! -f "/app/pom.xml" ]; do
    echo "â³ Esperando cÃ³digo fuente..."
    sleep 5
done

echo "ðŸ“¦ Compilando proyecto..."
mvn compile

echo "ðŸŒŸ Iniciando servidor backend..."
mvn exec:java -Dexec.mainClass=org.traccar.Main
EOF

RUN chmod +x /entrypoint.sh

# Start development server
CMD ["/entrypoint.sh"]
