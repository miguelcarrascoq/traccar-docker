FROM amazoncorretto:17-alpine

WORKDIR /app

# Install git and gradle (instead of maven)
RUN apk add --no-cache git

# Create entrypoint script
RUN cat > /entrypoint.sh << 'EOF'
#!/bin/sh
echo "🚀 Iniciando backend en modo desarrollo..."

# Esperar a que el código fuente esté disponible
while [ ! -f "/app/build.gradle" ]; do
    echo "⏳ Esperando código fuente..."
    sleep 5
done

echo "📦 Compilando proyecto con Gradle..."
./gradlew compileJava

echo "🌟 Iniciando servidor backend..."
./gradlew run
EOF

RUN chmod +x /entrypoint.sh

# Start development server
CMD ["/entrypoint.sh"]
